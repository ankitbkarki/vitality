<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Guided Meditation Script: Crafting Calm, Clarity, and Connection</title><meta name="description" content="Discover the power of guided meditation scripts for relaxation, focus, and sleep. Learn how to create and use them for lasting calm. Try now!"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="text/javascript" async src="https://www.googletagmanager.com/gtag/js?id=G-B538RQ55JN"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', 'G-B538RQ55JN' );</script><link rel="canonical" href="https://ankit-karki.com.np/blogs/guided-meditation-script-guide/"><link rel="alternate" type="application/atom+xml" href="https://ankit-karki.com.np/blogs/feed.xml" title="VITALITY BLOGS - RSS"><link rel="alternate" type="application/json" href="https://ankit-karki.com.np/blogs/feed.json" title="VITALITY BLOGS - JSON"><meta property="og:title" content="Guided Meditation Script: Crafting Calm, Clarity, and Connection"><meta property="og:image" content="https://ankit-karki.com.np/blogs/media/posts/50/Guided-Meditation-Script-Crafting-Calm-Clarity-and-Connection.png"><meta property="og:image:width" content="960"><meta property="og:image:height" content="640"><meta property="og:site_name" content="VITALITY BLOGS"><meta property="og:description" content="Discover the power of guided meditation scripts for relaxation, focus, and sleep. Learn how to create and use them for lasting calm. Try now!"><meta property="og:url" content="https://ankit-karki.com.np/blogs/guided-meditation-script-guide/"><meta property="og:type" content="article"><link rel="preload" href="https://ankit-karki.com.np/blogs/assets/dynamic/fonts/cairo/cairo.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://ankit-karki.com.np/blogs/assets/css/style.css?v=35201cb086536030dd169f7b3738d8e0"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ankit-karki.com.np/blogs/guided-meditation-script-guide/"},"headline":"Guided Meditation Script: Crafting Calm, Clarity, and Connection","datePublished":"2025-06-07T14:34-05:00","dateModified":"2025-06-07T15:40-05:00","image":{"@type":"ImageObject","url":"https://ankit-karki.com.np/blogs/media/posts/50/Guided-Meditation-Script-Crafting-Calm-Clarity-and-Connection.png","height":640,"width":960},"description":"Discover the power of guided meditation scripts for relaxation, focus, and sleep. Learn how to create and use them for lasting calm. Try now!","author":{"@type":"Person","name":"Leon","url":"https://ankit-karki.com.np/blogs/authors/leon-staff-team/"},"publisher":{"@type":"Organization","name":"Leon"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container"><header class="header" id="js-header"><a href="https://ankit-karki.com.np/blogs/" class="logo">VITALITY BLOGS</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://ankit-karki.com.np" target="_self">HOME</a></li><li><a href="https://ankit-karki.com.np/#contact" target="_self">CONTACT</a></li><li><a href="https://ankit-karki.com.np/privacy-policy" target="_self">PRIVACY</a></li><li><a href="https://ankit-karki.com.np/terms" target="_self">TERMS</a></li></ul></nav><div class="search"><a href="/blogs/search" class="search__btn" aria-label="Search"><svg role="presentation" focusable="false" height="15" width="15"><use xlink:href="https://ankit-karki.com.np/blogs/assets/svg/svg-map.svg#search"/></svg></a></div></header><main class="post"><article class="content wrapper"><header class="hero"><p class="content__meta">Published on <time datetime="2025-06-07T14:34">June 7, 2025</time></p><h1 class="content__title">Guided Meditation Script: Crafting Calm, Clarity, and Connection</h1></header><figure class="content__featured-image post__image--normal"><img src="https://ankit-karki.com.np/blogs/media/posts/50/Guided-Meditation-Script-Crafting-Calm-Clarity-and-Connection.png" srcset="https://ankit-karki.com.np/blogs/media/posts/50/responsive/Guided-Meditation-Script-Crafting-Calm-Clarity-and-Connection-xs.webp 300w, https://ankit-karki.com.np/blogs/media/posts/50/responsive/Guided-Meditation-Script-Crafting-Calm-Clarity-and-Connection-sm.webp 480w, https://ankit-karki.com.np/blogs/media/posts/50/responsive/Guided-Meditation-Script-Crafting-Calm-Clarity-and-Connection-md.webp 768w, https://ankit-karki.com.np/blogs/media/posts/50/responsive/Guided-Meditation-Script-Crafting-Calm-Clarity-and-Connection-lg.webp 1024w, https://ankit-karki.com.np/blogs/media/posts/50/responsive/Guided-Meditation-Script-Crafting-Calm-Clarity-and-Connection-xl.webp 1360w, https://ankit-karki.com.np/blogs/media/posts/50/responsive/Guided-Meditation-Script-Crafting-Calm-Clarity-and-Connection-2xl.webp 1600w, https://ankit-karki.com.np/blogs/media/posts/50/responsive/Guided-Meditation-Script-Crafting-Calm-Clarity-and-Connection-sm2.webp 375w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="640" width="960" alt=""><figcaption>Guided Meditation Script: Crafting Calm, Clarity, and Connection</figcaption></figure><div class="content__entry"><p>If you’ve ever dipped your toes into meditation, chances are you’ve encountered a <em>guided meditation script</em> or two. These carefully crafted narratives act as a gentle hand leading you through the landscape of your mind, body, and breath. But what exactly makes a guided meditation script tick? Why have they grown so popular, and how can you create or use one effectively? Let’s dive into the world of guided meditation scripts, unpacking their purpose, structure, and subtle magic.</p><h2>What Is a Guided Meditation Script?</h2><p>At its core, a guided meditation script is a written or spoken roadmap designed to steer your attention inward. Unlike silent meditation, where you sit with your thoughts freely, guided meditations offer cues — often a voice — that prompt you to focus on your breathing, bodily sensations, or imagery.</p><p>Imagine this: you’re lying on a beach, feeling waves lap at your toes, the sun warming your skin. A calm voice nudges you to notice each detail, anchoring you in the present moment. That narrative — that script — is what shapes your journey.</p><h2>Why Use a Guided Meditation Script?</h2><p>Meditation isn’t always easy, especially at the start. The mind loves to wander, jumping from one thought to another. Having a script can:</p><ul><li><p><strong>Provide structure:</strong> You’re not left to flounder; there’s a gentle path to follow.</p></li><li><p><strong>Enhance relaxation:</strong> Specific imagery or breathing instructions can deepen calm.</p></li><li><p><strong>Support beginners:</strong> New meditators often find a script less intimidating than silence.</p></li><li><p><strong>Tailor the experience:</strong> Scripts can be designed for various goals — stress relief, sleep, focus, or self-compassion.</p></li></ul><p>Personally, I remember the first time I tried a guided meditation script. It was oddly comforting to have someone’s voice steer me away from the whirlwind of daily worries — even if only for ten minutes.</p><h2>Anatomy of a Good Guided Meditation Script</h2><p>What sets a stellar guided meditation script apart? Here’s a rough breakdown of the elements that come together to create a smooth experience:</p><table><thead><tr><th>Component</th><th>Purpose</th><th>Example Phrase</th></tr></thead><tbody><tr><td><strong>Opening Grounding</strong></td><td>Helps the listener settle and focus</td><td>“Find a comfortable seated position. Close your eyes...”</td></tr><tr><td><strong>Breath Awareness</strong></td><td>Anchors attention and induces calm</td><td>“Take a deep breath in... and slowly exhale...”</td></tr><tr><td><strong>Body Scan</strong></td><td>Enhances relaxation and bodily presence</td><td>“Feel the weight of your feet on the floor...”</td></tr><tr><td><strong>Imagery/Visualization</strong></td><td>Deepens engagement, evokes calm or empowerment</td><td>“Picture a gentle stream flowing peacefully...”</td></tr><tr><td><strong>Affirmations/Intentions</strong></td><td>Cultivates positive mindset</td><td>“Repeat silently: I am calm and present.”</td></tr><tr><td><strong>Closing</strong></td><td>Gently brings the session to a close</td><td>“When you’re ready, slowly open your eyes...”</td></tr></tbody></table><p>This isn’t a rigid formula — some scripts skip or blend elements — but these pieces commonly show up.</p><h2>Popular Types of Guided Meditation Scripts</h2><p>Not all guided meditation scripts are created equal. Depending on what you need, you might gravitate toward different styles:</p><ul><li><p><strong>Mindfulness Meditation Scripts:</strong> Focus on present moment awareness, often through breath and sensations.</p></li><li><p><strong>Body Scan Meditation Scripts:</strong> Guide attention methodically through the body, releasing tension.</p></li><li><p><strong>Visualization Scripts:</strong> Paint vivid mental images to evoke calm or positivity.</p></li><li><p><strong>Sleep Meditation Scripts:</strong> Use soothing tones and progressive relaxation to lull the listener to sleep.</p></li><li><p><strong>Loving-Kindness (Metta) Scripts:</strong> Encourage cultivating compassion for self and others.</p></li></ul><p>If you’re curious, you can even find guided meditation scripts tailored for specific groups like kids, athletes, or people with anxiety.</p><h2>How to Write Your Own Guided Meditation Script</h2><p>Creating your own guided meditation script might sound intimidating, but it’s actually quite rewarding — and surprisingly accessible. Here’s a straightforward way to get started:</p><h3>Step 1: Set Your Intention</h3><p>Decide what you want the meditation to achieve. Is it to reduce stress, boost confidence, or help with sleep?</p><h3>Step 2: Choose a Comfortable Length</h3><p>For beginners, 5-10 minutes is a sweet spot. Longer sessions can be built up as you get more experienced.</p><h3>Step 3: Draft a Rough Outline</h3><p>Use the anatomy above as your skeleton. Jot down what you want to say at each stage.</p><h3>Step 4: Write Conversationally</h3><p>Remember — you’re talking <em>to</em> someone, not at them. Use a warm, gentle tone. Include pauses or reminders to breathe. For example:</p><p><em>“Take a moment here... let your shoulders drop...”</em></p><h3>Step 5: Test and Revise</h3><p>Read it aloud. Does it flow naturally? Is your pace soothing? Adjust accordingly.</p><h2>Guided Meditation Script Example: A Simple Body Scan</h2><p>To make this more concrete, here’s a brief example of a guided meditation script you might try or adapt.</p><p><strong>Begin by sitting or lying down comfortably. Close your eyes if that feels okay. Take a slow, deep breath in through your nose... and out through your mouth. Let’s do that again.</strong></p><p><strong>Now, gently bring your attention to the top of your head. Notice any sensations there. No need to change anything, just observe. Slowly, move your awareness down to your forehead, your eyes, your cheeks... Feel the calm begin to spread.</strong></p><p><strong>Continue scanning down your neck, shoulders, and arms. If you notice any tightness, breathe into that area, inviting it to soften.</strong></p><p><strong>Bring your attention to your chest and belly. Feel the rise and fall with each breath. Imagine warmth and relaxation pooling here.</strong></p><p><strong>Shift your focus to your legs, all the way down to your feet. Feel them heavy and grounded.</strong></p><p><strong>Take one more deep breath, and when you’re ready, slowly open your eyes, carrying this calm with you.</strong></p><h2>Using Guided Meditation Scripts: Tips for Listeners and Facilitators</h2><p>If you’re listening to a guided meditation script (via audio or a live guide), try to:</p><ul><li><p>Find a quiet, comfortable spot.</p></li><li><p>Minimize distractions (phone on silent, door closed).</p></li><li><p>Use headphones for better immersion.</p></li><li><p>Don’t worry if your mind wanders — just gently return to the guide’s voice.</p></li></ul><p>If you’re a facilitator leading others:</p><ul><li><p>Speak slowly and clearly, with pauses.</p></li><li><p>Use a soft, inviting tone.</p></li><li><p>Tailor the script’s pace and length to your audience’s needs.</p></li><li><p>Encourage feedback to improve future scripts.</p></li></ul><h2>The Science Behind Guided Meditation Scripts</h2><p>Why do these scripts work? Research points to several factors:</p><ul><li><p><strong>Focused attention:</strong> The script helps prevent the mind from drifting into stress-inducing thoughts.</p></li><li><p><strong>Relaxation response:</strong> Guided breathing and body awareness trigger parasympathetic nervous system activation, lowering heart rate and blood pressure.</p></li><li><p><strong>Neuroplasticity:</strong> Regular meditation can reshape brain pathways linked to emotional regulation and focus.</p></li><li><p><strong>Stress reduction:</strong> Studies show guided meditation decreases cortisol levels and improves mood.</p></li></ul><p>I tend to think this combination of mental guidance and physiological relaxation is why people often report feeling refreshed and grounded after just a few sessions.</p><h2>Common Challenges &amp; How to Overcome Them</h2><p>Even with guided meditation scripts, some obstacles pop up:</p><ul><li><p><strong>Restlessness or boredom:</strong> If a script feels too long or repetitive, try shorter sessions or more varied content.</p></li><li><p><strong>Difficulty focusing:</strong> It’s okay. Just gently bring attention back. Some people benefit from adding gentle background music.</p></li><li><p><strong>Discomfort in silence:</strong> Guided scripts can help fill this gap, making meditation less intimidating.</p></li></ul><h1>Summary Table: Guided Meditation Script Types &amp; Uses</h1><table><thead><tr><th>Script Type</th><th>Purpose</th><th>Best For</th><th>Typical Length</th></tr></thead><tbody><tr><td>Mindfulness</td><td>Present moment awareness</td><td>Beginners, stress relief</td><td>5-15 minutes</td></tr><tr><td>Body Scan</td><td>Physical relaxation &amp; tension release</td><td>Insomnia, anxiety relief</td><td>10-30 minutes</td></tr><tr><td>Visualization</td><td>Mental imagery for calm &amp; positivity</td><td>Creative blocks, confidence</td><td>10-20 minutes</td></tr><tr><td>Sleep</td><td>Progressive relaxation for sleep</td><td>Trouble sleeping, restlessness</td><td>15-40 minutes</td></tr><tr><td>Loving-Kindness</td><td>Cultivating compassion</td><td>Emotional well-being, self-esteem</td><td>10-20 minutes</td></tr></tbody></table><h1>FAQ: Guided Meditation Script</h1><p><strong>Q1: Can I use guided meditation scripts if I’m new to meditation?</strong><br>Absolutely! In fact, many beginners find scripts essential for staying focused and easing into meditation practice.</p><p><strong>Q2: How long should a guided meditation script be?</strong><br>It depends on your goals and experience, but 5-15 minutes is a great starting point. Longer scripts can be used as you grow more comfortable.</p><p><strong>Q3: Can I create my own guided meditation script?</strong><br>Yes! Writing your own allows you to personalize the experience, but keep it simple and conversational to stay engaging.</p><p><strong>Q4: Are guided meditation scripts effective for sleep?</strong><br>Definitely. Many sleep-focused scripts use calming imagery and progressive relaxation techniques to help ease the mind and body toward restful sleep.</p><p><strong>Q5: Should I follow a guided meditation script exactly or improvise?</strong><br>It’s your journey. Feel free to adapt scripts to suit your mood and needs — the best meditation is the one that works for you.</p></div><footer class="content__footer"><div class="content__last-updated">This article was updated on June 7, 2025</div><div class="content__footer__col"><ul class="content__tag"><li><a href="https://ankit-karki.com.np/blogs/tags/guided-meditation/">Guided Meditation</a></li></ul><div class="content__share"></div></div><nav class="content__nav"><div class="content__nav__prev">Previous Post<h5><a href="https://ankit-karki.com.np/blogs/changing-seasons-impact-mental-health/" class="invert" rel="prev">How Does Changing Seasons Impact Human Mental Health? Insights &amp; Tips</a></h5></div><div class="content__nav__next">Next Post<h5><a href="https://ankit-karki.com.np/blogs/how-to-meditate-on-gods-word-deepening-your-spiritual-walk/" class="invert" rel="next">How to Meditate on God’s Word: Deepening Your Spiritual Walk</a></h5></div></nav></footer></article></main><footer class="footer"><div class="footer__nav"><ul class="navbar__menu"><li><a href="https://ankit-karki.com.np" target="_self">HOME</a></li><li><a href="https://ankit-karki.com.np/#contact" target="_self">CONTACT</a></li><li><a href="https://ankit-karki.com.np/privacy-policy" target="_self">PRIVACY</a></li><li><a href="https://ankit-karki.com.np/terms" target="_self">TERMS</a></li></ul></div><div class="footer__copyright">© 2025 Vitality Blogs. All rights reserved.</div></footer></div><script defer="defer" src="https://ankit-karki.com.np/blogs/assets/js/scripts.min.js?v=4268bfae06e330d473c424d50f09abda"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.navbar'};</script><script>/*<![CDATA[*/var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};/*]]>*/</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">This website uses cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="https://leonstaff.com/privacy-policy.html">More details...</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--link pcb__btn--configure" aria-haspopup="dialog">Manage preferences</button> <button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button></div></div></div><div class="pcb__popup" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-popup-title"><div class="pcb__popup__wrapper"><div class="pcb__inner pcb__popup__inner"><div class="pcb__popup__heading"><div id="pcb-popup-title" role="heading" aria-level="2" class="pcb__title">Cookie settings</div><button class="pcb__popup__close" aria-label="Close"></button></div><div class="pcb__popup__content"><div class="pcb__txt pcb__popup__txt">We use cookies to enhance your browsing experience, serve personalized ads or content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies. <a href="https://leonstaff.com/privacy-policy.html">More details...</a></div><ul class="pcb__groups"><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Required</summary></details><div class="pcb__popup__switch is-checked"><input type="checkbox" data-group-name="" id="pcb-group-0" checked="checked"> <label for="pcb-group-0">Required</label></div></li></ul></div><div class="pcb__buttons pcb__popup__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject all</button> <button type="button" class="pcb__btn pcb__btn--save">Save settings</button></div></div></div></div><div class="pcb__overlay" aria-hidden="true"></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        initialLsState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                    'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                    'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                    'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                    'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                    'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                    'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                });  
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                        'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                        'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                        'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                        'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                        'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                        'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                    }));
                }
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            cbConfig.initialLsState = currentConfig.split(',');

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                    'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                    'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                    'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                    'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                    'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                    'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                });
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                        'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                        'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                        'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                        'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                        'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                        'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                    }));
                }
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function getDefaultConsentState (currentConfig, consentGroup) {
        let configGroups = currentConfig.split(',');

        for (let i = 0; i < configGroups.length; i++) {
            let groupName = configGroups[i];
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === groupName);

            if (group && group[consentGroup]) {
                return 'granted';
            }
        }  
        
        if (window.publiiCBGCM.defaultState[consentGroup]) {
            return 'granted'; 
        }
        
        return 'denied';
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }

        if (window.publiiCBGCM && (!cbConfig.initialLsState || cbConfig.initialLsState.indexOf(allowedGroup) === -1)) {
            let consentResult = {};
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === allowedGroup);

            if (group) {
                let foundSomeConsents = false;

                Object.keys(group).forEach(key => {
                    if (key !== 'cookieGroup' && group[key] === true) {
                        consentResult[key] = 'granted';
                        foundSomeConsents = true;
                    }
                });

                if (foundSomeConsents) {
                    gtag('consent', 'update', consentResult);   

                    if (cbConfig.debugMode) {
                        console.log('🍪 GCMv2 UPDATE: ' + JSON.stringify(consentResult));
                    }
                }
            }
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupToCheck !== '' && groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>